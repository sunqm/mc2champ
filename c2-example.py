from pyscf import gto
from pyscf import scf
from pyscf import mcscf
from pyscf import lib
import mc2champ
from pyscf.tools import dump_mat

cbasis, bextra = mc2champ.parse_basis('''
  11   1S      1             7.5000000         15333.6370468      0.000423192570
  11   1S      2                                2812.0556116      0.002381039318
  11   1S      3                                 787.3987734      0.009323817678
  11   1S      4                                 271.2386280      0.029449066147
  11   1S      5                                 106.3608728      0.078182257712
  11   1S      6                                  45.6703920      0.172173917294
  11   1S      7                                  20.9824484      0.293804943562
  11   1S      8                                  10.1460918      0.335431635380
  11   1S      9                                   5.0791907      0.193156674504
  11   1S     10                                   2.5474391      0.030650811270

  12   1S     11             5.4000000          7948.9574451      0.000423192570
  12   1S     12                                1457.7696291      0.002381039318
  12   1S     13                                 408.1875241      0.009323817678
  12   1S     14                                 140.6101048      0.029449066147
  12   1S     15                                  55.1374765      0.078182257712
  12   1S     16                                  23.6755312      0.172173917294
  12   1S     17                                  10.8773012      0.293804943562
  12   1S     18                                   5.2597340      0.335431635380
  12   1S     19                                   2.6330524      0.193156674504
  12   1S     20                                   1.3205924      0.030650811270

  13   2S     21             2.0000000          1520.2600098     -0.000161084288
  13   2S     22                                 278.8352051     -0.000902043073
  13   2S     23                                  78.0391998     -0.003484545043
  13   2S     24                                  26.8148003     -0.010623130016
  13   2S     25                                  10.4363632     -0.025615792722
  13   2S     26                                   4.4185863     -0.040985733271
  13   2S     27                                   0.9638411      0.203561156988
  13   2S     28                                   0.4919133      0.460497528315
  13   2S     29                                   0.2619877      0.350348800421
  13   2S     30                                   0.1406738      0.058966025710

  14   2S     31             1.1000000           459.8786530     -0.000161084288
  14   2S     32                                  84.3476495     -0.000902043073
  14   2S     33                                  23.6068579     -0.003484545043
  14   2S     34                                   8.1114771     -0.010623130016
  14   2S     35                                   3.1569999     -0.025615792722
  14   2S     36                                   1.3366223     -0.040985733271
  14   2S     37                                   0.2915619      0.203561156988
  14   2S     38                                   0.1488038      0.460497528315
  14   2S     39                                   0.0792513      0.350348800421
  14   2S     40                                   0.0425538      0.058966025710

  15   2P     41             6.0000000          1536.6454926      0.000255017076
  15   2P     42                                 401.4008789      0.001829099841
  15   2P     43                                 144.1380501      0.008612751029
  15   2P     44                                  60.7165389      0.031150894240
  15   2P     45                                  28.2880354      0.089759565890
  15   2P     46                                  14.1448857      0.201379358768
  15   2P     47                                   7.4511139      0.325596928596
  15   2P     48                                   4.0768850      0.326958388090
  15   2P     49                                   2.2814808      0.155687600374
  15   2P     50                                   1.2657842      0.019753307104

  16   2P     51             3.6000000           553.1923773      0.000255017076
  16   2P     52                                 144.5043164      0.001829099841
  16   2P     53                                  51.8896980      0.008612751029
  16   2P     54                                  21.8579540      0.031150894240
  16   2P     55                                  10.1836927      0.089759565890
  16   2P     56                                   5.0921588      0.201379358768
  16   2P     57                                   2.6824010      0.325596928596
  16   2P     58                                   1.4676786      0.326958388090
  16   2P     59                                   0.8213331      0.155687600374
  16   2P     60                                   0.4556823      0.019753307104

  17   2P     61             2.4000000           245.8632788      0.000255017076
  17   2P     62                                  64.2241406      0.001829099841
  17   2P     63                                  23.0620880      0.008612751029
  17   2P     64                                   9.7146462      0.031150894240
  17   2P     65                                   4.5260857      0.089759565890
  17   2P     66                                   2.2631817      0.201379358768
  17   2P     67                                   1.1921782      0.325596928596
  17   2P     68                                   0.6523016      0.326958388090
  17   2P     69                                   0.3650369      0.155687600374
  17   2P     70                                   0.2025255      0.019753307104

  18   2P     71             1.2000000            61.4658197      0.000255017076
  18   2P     72                                  16.0560352      0.001829099841
  18   2P     73                                   5.7655220      0.008612751029
  18   2P     74                                   2.4286616      0.031150894240
  18   2P     75                                   1.1315214      0.089759565890
  18   2P     76                                   0.5657954      0.201379358768
  18   2P     77                                   0.2980446      0.325596928596
  18   2P     78                                   0.1630754      0.326958388090
  18   2P     79                                   0.0912592      0.155687600374
  18   2P     80                                   0.0506314      0.019753307104

  19   3S     81             2.7000000           166.0910108     -0.000096246098
  19   3S     82                                  46.4661755     -0.001095804386
  19   3S     83                                  17.8775491     -0.006813541055
  19   3S     84                                   8.0511302     -0.028354806826
  19   3S     85                                   4.0078993     -0.078944660723
  19   3S     86                                   2.1453583     -0.122064769268
  19   3S     87                                   0.7193685      0.357812821865
  19   3S     88                                   0.4402305      0.524196505547
  19   3S     89                                   0.2744921      0.238117516041
  19   3S     90                                   0.1694505      0.022446893156

  20   3D     91             2.6000000            90.5420865      0.000178817631
  20   3D     92                                  29.1395870      0.001556501375
  20   3D     93                                  12.1638141      0.008423312567
  20   3D     94                                   5.7945445      0.033440444618
  20   3D     95                                   3.0013649      0.100887432694
  20   3D     96                                   1.6483418      0.225321233273
  20   3D     97                                   0.9446558      0.344351470470
  20   3D     98                                   0.5578181      0.311593115330
  20   3D     99                                   0.3345179      0.128915205598
  20   3D    100                                   0.1978201      0.013938680291
  ''')

mol = gto.Mole()
mol.build(
    verbose = 5,
    output = 'c2-example.out',
    atom = [
        ["C", (0., 0., -1.17405*lib.parameters.BOHR)],
        ["C", (0., 0.,  1.17405*lib.parameters.BOHR)],],
    basis = {'C': cbasis },
    symmetry = 1,
)

mf = scf.RHF(mol)
mf.scf()

mc = mcscf.CASSCF(mol, mf, 8, 8)
mo = mcscf.addons.sort_mo(mc, mf.mo_coeff, [3,4,5,6,7,8,9,11])
mc.mc1step(mo)
mc.fcisolver.conv_tol=1e-10
mc.cas_natorb_()

mol.stdout.write('\nCASSCF result\n')
mol.stdout.write('MO coefficients\n')
label = ['%d%3s %s%-4s' % x for x in mol.spheric_labels()]
dump_mat.dump_rec(mol.stdout, mc.mo_coeff, label, start=1)

#mol.stdout.write('\nCI coefficients\n')
#dump_mat.dump_rec(mol.stdout, mc.ci, start=1)

from pyscf import fci
ss = mcscf.addons.spin_square(mc)
mol.stdout.write('\nS^2 = %f, 2S+1 = %f\n' % tuple(ss))

blabel = ({'C': bextra[0]}, {'C':bextra[1]})
mc2champ.make_champ_input('c2-example.inp', mc, blabel=blabel)
